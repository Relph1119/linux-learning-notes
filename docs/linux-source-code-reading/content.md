# 《Linux源码趣读》学习笔记

- Linux代码获取地址：https://mirrors.edge.kernel.org/pub/linux/kernel/Historic/old-versions/
- Linux内核版本：V0.11
- 本书资料：https://github.com/dibingfa/flash-linux0.11-talk

## 第一部分 进入内核前的苦力活

本部分共包含10回内容，主要讲述了如下内容：
1. 加载启动区：开机之后，BIOS将硬盘启动区的512字节数据复制到内存`0x7c00`位置。将`0x7c00`的512字节数据移动到`0x90000`位置。设置代码段CS地址为`0x9000`，设置数据段DS地址为`0x9000`，设置栈顶位置指向`0x9FF00`处。
2. 【`bootsect.s`】加载`setup.s`：将硬盘的`setup`代码（第2\~5扇区）加载到`0x90200`，将`system`代码（240个扇区）加载到`0x10000`。
3. 【`bootsect.s`】加载内核：将`system`代码复制到`0x00000`处，并将系统信息设置在`0x90000`开始的内存中，包括光标位置、扩展内存数、显示页面等各个设备的参数信息。
4. 【`setup.s`】分段机制：设置全局描述符表GDT。
5. 【`setup.s`】进入保护模式：打开A20地址线，从16位实模式转换到32位保护模式，设置中断描述符表IDT。
6. 【`head.s`】重新设置中断描述符表（IDT）和全局描述符表（GDT）。
7. 【`head.s`】开启分页机制。
8. 【`head.s`】跳转到内核：跳转`main`函数。

![第一部分之后的操作系统的内存分配](part01/images/ch10-memory-before-main.png)

## 第二部分 “大战”前期的初始化工作

本部分共包含10回内容，主要讲述了如下内容：
1. 【`init/main.c`】整个操作系统的启动分为4步：主内存和缓冲区边界的取值和计算、一系列初始化、切换到用户态模式进行最终的初始化、死循环（等待任务运行）。
2. 【`mm/memory.c`】主内存初始化：使用`mem_map`数组管理内存的使用情况。
3. 【`kernel/traps.c`】中断初始化：初始化`0\~0x10`的中断处理函数。
4. 【`kernel/blk_drv/ll_rw_bkl.c`】块设备请求项初始化：将块设备的读写请求封装为一个`request`结构放到`request[]`数组中进行管理。
5. 【`kernel/chr_drv/console.c`】控制台初始化：结合图形视频缓冲区，实现在控制台输出字符，并可以支持换行、滚屏等操作。
6. 【`init/main.c`】时间初始化：使用CPU对CMOS交互，并获取时间。
7. 【`kernel/sched.c`】进程调度初始化：初始化进程的任务状态段（TSS）和局部描述符表（LDT），初始化`0x20`（时间中断）、`0x21`（键盘中断）和`0x80`（系统调用中断）的中断处理函数。
8. 【`fs/buffer.c`】缓冲区初始化：建立缓冲区的双向链表，每个元素包含缓冲头和1024B的缓冲块。
9. 【`kernel/blk_drv/hd.c`】硬盘初始化：初始化硬盘读写请求，并初始化`0x2E`（硬盘读写中断）的中断处理函数。

![第二部分之后的操作系统的内存分配](part02/images/ch18-tss-ldt.png)